version: "3.8"

services:
  # React Frontend (Vite)
  frontend:
    build:
      context: ../../ryxhub
      dockerfile: ../docker/ryxhub/Dockerfile.frontend
    container_name: ryx-hub-frontend
    ports:
      - "5173:5173"
    environment:
      - VITE_RYX_API_URL=http://localhost:8420
      - VITE_USE_MOCK_API=false
    restart: unless-stopped
    networks:
      - ryxhub-network

  # FastAPI Backend (connects to vLLM)
  backend:
    build:
      context: ../..
      dockerfile: docker/ryxhub/Dockerfile.backend
    container_name: ryx-hub-backend
    ports:
      - "8420:8420"
    volumes:
      - ../../data:/app/data
      - ../../configs:/app/configs
    environment:
      - VLLM_BASE_URL=http://host.docker.internal:8001
      - SEARXNG_URL=http://host.docker.internal:8888
      - RYX_API_PORT=8420
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    networks:
      - ryxhub-network

networks:
  ryxhub-network:
    driver: bridge
