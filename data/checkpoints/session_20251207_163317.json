{
  "session_id": "20251207_163317",
  "checkpoints": [
    {
      "id": "Modify manager.py_988ed0",
      "name": "Modify manager.py",
      "description": "",
      "changes": [
        {
          "path": "/home/tobi/ryx-ai/ryxsurf/src/sessions/manager.py",
          "change_type": "modify",
          "old_content": "\"\"\"\nRyxSurf Session Manager\n\nHandles saving, loading, and switching between tab sessions.\nSessions are named groups of tabs (school, work, chill, etc.)\n\"\"\"\n\nimport json\nfrom pathlib import Path\nfrom dataclasses import dataclass, field, asdict\nfrom typing import List, Dict, Optional\nfrom datetime import datetime\n\n\n@dataclass\nclass TabState:\n    \"\"\"Serializable tab state\"\"\"\n    url: str\n    title: str\n    scroll_position: int = 0\n    is_pinned: bool = False\n    favicon_url: Optional[str] = None\n\n\n@dataclass \nclass SessionState:\n    \"\"\"A complete session with all tabs\"\"\"\n    name: str\n    tabs: List[TabState] = field(default_factory=list)\n    active_tab: int = 0\n    created_at: str = field(default_factory=lambda: datetime.now().isoformat())\n    updated_at: str = field(default_factory=lambda: datetime.now().isoformat())\n    color: str = \"#6272a4\"  # Dracula purple default\n    \n    def to_dict(self) -> dict:\n        return {\n            \"name\": self.name,\n            \"tabs\": [asdict(t) for t in self.tabs],\n            \"active_tab\": self.active_tab,\n            \"created_at\": self.created_at,\n            \"updated_at\": self.updated_at,\n            \"color\": self.color\n        }\n    \n    @classmethod\n    def from_dict(cls, data: dict) -> 'SessionState':\n        tabs = [TabState(**t) for t in data.get(\"tabs\", [])]\n        return cls(\n            name=data[\"name\"],\n            tabs=tabs,\n            active_tab=data.get(\"active_tab\", 0),\n            created_at=data.get(\"created_at\", \"\"),\n            updated_at=data.get(\"updated_at\", \"\"),\n            color=data.get(\"color\", \"#6272a4\")\n        )\n\n\nclass SessionManager:\n    \"\"\"\n    Manages browser sessions.\n    \n    Features:\n    - Save/load sessions to disk\n    - Quick switch between sessions\n    - Auto-save on tab changes\n    - Session colors for visual distinction\n    \"\"\"\n    \n    def __init__(self, session_dir: Optional[Path] = None):\n        self.session_dir = session_dir or Path.home() / \".config\" / \"ryxsurf\" / \"sessions\"\n        self.session_dir.mkdir(parents=True, exist_ok=True)\n        \n        self.current_session: str = \"default\"\n        self.sessions: Dict[str, SessionState] = {}\n        \n        # Load existing sessions\n        self._load_all_sessions()\n        \n    def _load_all_sessions(self):\n        \"\"\"Load all sessions from disk\"\"\"\n        for session_file in self.session_dir.glob(\"*.json\"):\n            try:\n                data = json.loads(session_file.read_text())\n                session = SessionState.from_dict(data)\n                self.sessions[session.name] = session\n            except Exception as e:\n                print(f\"Failed to load session {session_file}: {e}\")\n                \n        # Ensure default session exists\n        if \"default\" not in self.sessions:\n            self.sessions[\"default\"] = SessionState(name=\"default\")\n            \n    def save_session(self, name: str, tabs: List[TabState], active_tab: int = 0):\n        \"\"\"Save a session to disk\"\"\"\n        if name in self.sessions:\n            session = self.sessions[name]\n            session.tabs = tabs\n            session.active_tab = active_tab\n            session.updated_at = datetime.now().isoformat()\n        else:\n            session = SessionState(\n                name=name,\n                tabs=tabs,\n                active_tab=active_tab\n            )\n            self.sessions[name] = session\n            \n        # Write to disk\n        session_file = self.session_dir / f\"{name}.json\"\n        session_file.write_text(json.dumps(session.to_dict(), indent=2))\n        \n    def load_session(self, name: str) -> Optional[SessionState]:\n        \"\"\"Load a session by name\"\"\"\n        return self.sessions.get(name)\n        \n    def switch_session(self, name: str) -> Optional[SessionState]:\n        \"\"\"Switch to a different session\"\"\"\n        if name not in self.sessions:\n            return None\n            \n        self.current_session = name\n        return self.sessions[name]\n        \n    def list_sessions(self) -> List[str]:\n        \"\"\"List all session names\"\"\"\n        return list(self.sessions.keys())\n        \n    def delete_session(self, name: str) -> bool:\n        \"\"\"Delete a session\"\"\"\n        if name == \"default\":\n            return False  # Can't delete default\n            \n        if name in self.sessions:\n            del self.sessions[name]\n            session_file = self.session_dir / f\"{name}.json\"\n            if session_file.exists():\n                session_file.unlink()\n            return True\n        return False\n        \n    def rename_session(self, old_name: str, new_name: str) -> bool:\n        \"\"\"Rename a session\"\"\"\n        if old_name not in self.sessions or new_name in self.sessions:\n            return False\n            \n        session = self.sessions.pop(old_name)\n        session.name = new_name\n        self.sessions[new_name] = session\n        \n        # Rename file\n        old_file = self.session_dir / f\"{old_name}.json\"\n        new_file = self.session_dir / f\"{new_name}.json\"\n        \n        if old_file.exists():\n            old_file.rename(new_file)\n            \n        return True\n        \n    def set_session_color(self, name: str, color: str):\n        \"\"\"Set session color for UI\"\"\"\n        if name in self.sessions:\n            self.sessions[name].color = color\n            self.save_session(name, self.sessions[name].tabs, self.sessions[name].active_tab)\n            \n    def get_session_info(self) -> List[Dict]:\n        \"\"\"Get info about all sessions for UI\"\"\"\n        return [\n            {\n                \"name\": s.name,\n                \"tab_count\": len(s.tabs),\n                \"color\": s.color,\n                \"updated_at\": s.updated_at,\n                \"is_current\": s.name == self.current_session\n            }\n            for s in self.sessions.values()\n        ]\n",
          "new_content": "\"\"\"\nRyxSurf Session Manager\n\nHandles saving, loading, and switching between tab sessions.\nSessions are named groups of tabs (school, work, chill, etc.)\n\"\"\"\n\nimport json\nfrom pathlib import Path\nfrom dataclasses import dataclass, field, asdict\nfrom typing import List, Dict, Optional\nfrom datetime import datetime\n\n\n@dataclass\nclass TabState:\n    \"\"\"Serializable tab state\"\"\"\n    url: str\n    title: str\n    scroll_position: int = 0\n    is_pinned: bool = False\n    favicon_url: Optional[str] = None\n\n\n@dataclass \nclass SessionState:\n    \"\"\"A complete session with all tabs\"\"\"\n    name: str\n    tabs: List[TabState] = field(default_factory=list)\n    active_tab: int = 0\n    created_at: str = field(default_factory=lambda: datetime.now().isoformat())\n    updated_at: str = field(default_factory=lambda: datetime.now().isoformat())\n    color: str = \"#6272a4\"  # Dracula purple default\n    \n    def to_dict(self) -> dict:\n        return {\n            \"name\": self.name,\n            \"tabs\": [asdict(t) for t in self.tabs],\n            \"active_tab\": self.active_tab,\n            \"created_at\": self.created_at,\n            \"updated_at\": self.updated_at,\n            \"color\": self.color\n        }\n    \n    @classmethod\n    def from_dict(cls, data: dict) -> 'SessionState':\n        tabs = [TabState(**t) for t in data.get(\"tabs\", [])]\n        return cls(\n            name=data[\"name\"],\n            tabs=tabs,\n            active_tab=data.get(\"active_tab\", 0),\n            created_at=data.get(\"created_at\", \"\"),\n            updated_at=data.get(\"updated_at\", \"\"),\n            color=data.get(\"color\", \"#6272a4\")\n        )\n\n\nclass SessionManager:\n    \"\"\"\n    Manages browser sessions.\n    \n    Features:\n    - Save/load sessions to disk\n    - Quick switch between sessions\n    - Auto-save on tab changes\n    - Session colors for visual distinction\n    \"\"\"\n    \n    def __init__(self, session_dir: Optional[Path] = None):\n        self.session_dir = session_dir or Path.home() / \".config\" / \"ryxsurf\" / \"sessions\"\n        self.session_dir.mkdir(parents=True, exist_ok=True)\n        \n        self.current_session: str = \"default\"\n        self.sessions: Dict[str, SessionState] = {}\n        \n        # Load existing sessions\n        self._load_all_sessions()\n        \n    def _load_all_sessions(self):\n        \"\"\"Load all sessions from disk\"\"\"\n        for session_file in self.session_dir.glob(\"*.json\"):\n            try:\n                data = json.loads(session_file.read_text())\n                session = SessionState.from_dict(data)\n                self.sessions[session.name] = session\n            except Exception as e:\n                print(f\"Failed to load session {session_file}: {e}\")\n                \n        # Ensure default session exists\n        if \"default\" not in self.sessions:\n            self.sessions[\"default\"] = SessionState(name=\"default\")\n            \n    def save_session(self, name: str, tabs: List[TabState], active_tab: int = 0):\n        \"\"\"Save a session to disk\"\"\"\n        if name in self.sessions:\n            session = self.sessions[name]\n            session.tabs = tabs\n            session.active_tab = active_tab\n            session.updated_at = datetime.now().isoformat()\n        else:\n            session = SessionState(\n                name=name,\n                tabs=tabs,\n                active_tab=active_tab\n            )\n            self.sessions[name] = session\n            \n        # Write to disk\n        session_file = self.session_dir / f\"{name}.json\"\n        session_file.write_text(json.dumps(session.to_dict(), indent=2))\n        \n    def load_session(self, name: str) -> Optional[SessionState]:\n        \"\"\"Load a session by name\"\"\"\n        return self.sessions.get(name)\n        \n    def switch_session(self, name: str) -> Optional[SessionState]:\n        \"\"\"Switch to a different session\"\"\"\n        if name not in self.sessions:\n            return None\n            \n        self.current_session = name\n        return self.sessions[name]\n        \n    def list_sessions(self) -> List[str]:\n        \"\"\"List all session names\"\"\"\n        return list(self.sessions.keys())\n        \n    def delete_session(self, name: str) -> bool:\n        \"\"\"Delete a session\"\"\"\n        if name == \"default\":\n            return False  # Can't delete default\n            \n        if name in self.sessions:\n            del self.sessions[name]\n            session_file = self.session_dir / f\"{name}.json\"\n            if session_file.exists():\n                session_file.unlink()\n            return True\n        return False\n        \n    def rename_session(self, old_name: str, new_name: str) -> bool:\n        \"\"\"Rename a session\"\"\"\n        if old_name not in self.sessions or new_name in self.sessions:\n            return False\n            \n        session = self.sessions.pop(old_name)\n        session.name = new_name\n        self.sessions[new_name] = session\n        \n        # Rename file\n        old_file = self.session_dir / f\"{old_name}.json\"\n        new_file = self.session_dir / f\"{new_name}.json\"\n        \n        if old_file.exists():\n            old_file.rename(new_file)\n            \n        return True\n        \n    def set_session_color(self, name: str, color: str):\n        \"\"\"Set session color for UI\"\"\"\n        if name in self.sessions:\n            self.sessions[name].color = color\n            self.save_session(name, self.sessions[name].tabs, self.sessions[name].active_tab)\n            \n    def get_session_info(self) -> List[Dict]:\n        \"\"\"Get info about all sessions for UI\"\"\"\n        return [\n            {\n                \"name\": s.name,\n                \"tab_count\": len(s.tabs),\n                \"color\": s.color,\n                \"updated_at\": s.updated_at,\n                \"is_current\": s.name == self.current_session\n            }\n            for s in self.sessions.values()\n        ]\n        \n    def quick_switch(self, session_name: str) -> Optional[SessionState]:\n        \"\"\"Quickly switch to a different session by saving the current one and loading the new one.\"\"\"\n        self.save_session(self.current_session, self.sessions[self.current_session].tabs, self.sessions[self.current_session].active_tab)\n        return self.switch_session(session_name)",
          "old_path": null,
          "timestamp": "2025-12-07T16:33:17.541754"
        }
      ],
      "timestamp": "2025-12-07T16:33:17.541743",
      "task_context": "In ryxsurf/src/sessions/manager.py, add a method called quick_switch(session_name: str) that:\n1. Calls self.save_session() with the current session\n2. Calls self.switch_session(session_name)\n3. Returns the new session state\n\nThis file is only 177 lines. KEEP all existing code."
    }
  ],
  "last_updated": "2025-12-07T16:37:53.753832"
}